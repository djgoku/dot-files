#!/usr/bin/env zsh
#MISE description="Generate ~/.gnupg/gpg-agent.conf"
set -euo pipefail

mkdir -p ~/.gnupg
cat > ~/.gnupg/gpg-agent.conf << EOF
# Generated by: mise run setup-gpg-agent
# https://www.gnupg.org/documentation/manuals/gnupg/Agent-Options.html
pinentry-program $MISE_PROJECT_ROOT/mise-tasks/pinentry-auto
enable-ssh-support
ttyname \$GPG_TTY
default-cache-ttl 60
max-cache-ttl 120
allow-emacs-pinentry
EOF
echo "Generated ~/.gnupg/gpg-agent.conf"
gpgconf --reload gpg-agent && echo "gpg-agent reloaded"
